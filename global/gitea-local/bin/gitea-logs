#!/usr/bin/env bash
# gitea-logs - View Gitea server logs

# Colors
BLUE='\033[0;34m'
NC='\033[0m'

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
GITEA_DIR="$(dirname "$SCRIPT_DIR")"
LOG_FILE="$GITEA_DIR/gitea-server.log"

# Parse arguments
FOLLOW=false
LINES=50

while [[ $# -gt 0 ]]; do
    case $1 in
        -f|--follow)
            FOLLOW=true
            shift
            ;;
        -n|--lines)
            LINES="$2"
            shift 2
            ;;
        -h|--help)
            echo "Usage: gitea-logs [OPTIONS]"
            echo ""
            echo "Options:"
            echo "  -f, --follow       Follow log output (like tail -f)"
            echo "  -n, --lines N      Show last N lines (default: 50)"
            echo "  -h, --help         Show this help"
            echo ""
            echo "Examples:"
            echo "  gitea-logs              Show last 50 lines"
            echo "  gitea-logs -n 100       Show last 100 lines"
            echo "  gitea-logs -f           Follow logs in real-time"
            exit 0
            ;;
        *)
            echo "Unknown option: $1"
            echo "Use -h for help"
            exit 1
            ;;
    esac
done

if [[ ! -f "$LOG_FILE" ]]; then
    echo "Log file not found: $LOG_FILE"
    echo "Start Gitea first: gitea-start"
    exit 1
fi

echo -e "${BLUE}=== Gitea Server Logs ===${NC}"
echo "File: $LOG_FILE"
echo ""

if [[ "$FOLLOW" == true ]]; then
    echo -e "${BLUE}Following logs (Ctrl+C to stop)...${NC}"
    echo ""
    tail -f "$LOG_FILE"
else
    tail -n "$LINES" "$LOG_FILE"
fi
